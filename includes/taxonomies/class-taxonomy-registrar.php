<?php
namespace Parfume_Reviews\Taxonomies;

/**
 * Taxonomy Registrar - –æ—Ç–≥–æ–≤–∞—Ä—è –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ç–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏
 * üìÅ –§–∞–π–ª: includes/taxonomies/class-taxonomy-registrar.php
 * –ü–û–ü–†–ê–í–ï–ù–û: brands_slug default –æ—Ç 'marki' –Ω–∞ 'parfumeri'
 */
class Taxonomy_Registrar {
    
    public function __construct() {
        add_action('init', array($this, 'register_taxonomies'), 0);
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ –≤—Å–∏—á–∫–∏ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏
     */
    public function register_taxonomies() {
        $settings = get_option('parfume_reviews_settings', array());
        $parfume_slug = !empty($settings['parfume_slug']) ? $settings['parfume_slug'] : 'parfiumi';
        
        $this->register_gender_taxonomy($settings, $parfume_slug);
        $this->register_aroma_type_taxonomy($settings, $parfume_slug);
        $this->register_brands_taxonomy($settings, $parfume_slug);
        $this->register_season_taxonomy($settings, $parfume_slug);
        $this->register_intensity_taxonomy($settings, $parfume_slug);
        $this->register_notes_taxonomy($settings, $parfume_slug);
        $this->register_perfumer_taxonomy($settings, $parfume_slug);
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Gender taxonomy
     */
    private function register_gender_taxonomy($settings, $parfume_slug) {
        $gender_slug = !empty($settings['gender_slug']) ? $settings['gender_slug'] : 'gender';
        
        $gender_labels = array(
            'name' => __('–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', 'parfume-reviews'),
            'singular_name' => __('–ö–∞—Ç–µ–≥–æ—Ä–∏—è', 'parfume-reviews'),
            'search_items' => __('–¢—ä—Ä—Å–µ–Ω–µ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏—Ç–µ', 'parfume-reviews'),
            'all_items' => __('–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'parfume-reviews'),
            'edit_item' => __('–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è', 'parfume-reviews'),
            'update_item' => __('–û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è', 'parfume-reviews'),
            'add_new_item' => __('–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è', 'parfume-reviews'),
            'new_item_name' => __('–ò–º–µ –Ω–∞ –Ω–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è', 'parfume-reviews'),
            'menu_name' => __('–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', 'parfume-reviews'),
        );
        
        register_taxonomy('gender', 'parfume', array(
            'labels' => $gender_labels,
            'hierarchical' => true,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $gender_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_categories_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_gender_terms();
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Aroma Type taxonomy
     */
    private function register_aroma_type_taxonomy($settings, $parfume_slug) {
        $aroma_type_slug = !empty($settings['aroma_type_slug']) ? $settings['aroma_type_slug'] : 'aroma-type';
        
        $aroma_type_labels = array(
            'name' => __('–í–∏–¥–æ–≤–µ –∞—Ä–æ–º–∞—Ç–∏', 'parfume-reviews'),
            'singular_name' => __('–í–∏–¥ –∞—Ä–æ–º–∞', 'parfume-reviews'),
            'search_items' => __('–¢—ä—Ä—Å–µ–Ω–µ –≤—ä–≤ –≤–∏–¥–æ–≤–µ—Ç–µ –∞—Ä–æ–º–∞—Ç–∏', 'parfume-reviews'),
            'all_items' => __('–í—Å–∏—á–∫–∏ –≤–∏–¥–æ–≤–µ –∞—Ä–æ–º–∞—Ç–∏', 'parfume-reviews'),
            'edit_item' => __('–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –≤–∏–¥ –∞—Ä–æ–º–∞', 'parfume-reviews'),
            'update_item' => __('–û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –≤–∏–¥ –∞—Ä–æ–º–∞', 'parfume-reviews'),
            'add_new_item' => __('–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤ –≤–∏–¥ –∞—Ä–æ–º–∞', 'parfume-reviews'),
            'new_item_name' => __('–ò–º–µ –Ω–∞ –Ω–æ–≤ –≤–∏–¥ –∞—Ä–æ–º–∞', 'parfume-reviews'),
            'menu_name' => __('–í–∏–¥–æ–≤–µ –∞—Ä–æ–º–∞—Ç–∏', 'parfume-reviews'),
        );
        
        register_taxonomy('aroma_type', 'parfume', array(
            'labels' => $aroma_type_labels,
            'hierarchical' => true,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $aroma_type_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_categories_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_aroma_type_terms();
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Brands taxonomy
     */
    private function register_brands_taxonomy($settings, $parfume_slug) {
        // –ü–û–ü–†–ê–í–ï–ù–û: brands_slug default –æ—Ç 'marki' –Ω–∞ 'parfumeri'
        $brands_slug = !empty($settings['brands_slug']) ? $settings['brands_slug'] : 'parfumeri';
        
        $brands_labels = array(
            'name' => __('–ú–∞—Ä–∫–∏', 'parfume-reviews'),
            'singular_name' => __('–ú–∞—Ä–∫–∞', 'parfume-reviews'),
            'search_items' => __('–¢—ä—Ä—Å–µ–Ω–µ –≤ –º–∞—Ä–∫–∏—Ç–µ', 'parfume-reviews'),
            'all_items' => __('–í—Å–∏—á–∫–∏ –º–∞—Ä–∫–∏', 'parfume-reviews'),
            'edit_item' => __('–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –º–∞—Ä–∫–∞', 'parfume-reviews'),
            'update_item' => __('–û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –º–∞—Ä–∫–∞', 'parfume-reviews'),
            'add_new_item' => __('–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –º–∞—Ä–∫–∞', 'parfume-reviews'),
            'new_item_name' => __('–ò–º–µ –Ω–∞ –Ω–æ–≤–∞ –º–∞—Ä–∫–∞', 'parfume-reviews'),
            'menu_name' => __('–ú–∞—Ä–∫–∏', 'parfume-reviews'),
        );
        
        register_taxonomy('marki', 'parfume', array(
            'labels' => $brands_labels,
            'hierarchical' => true,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $brands_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_categories_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_brand_terms();
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Season taxonomy
     */
    private function register_season_taxonomy($settings, $parfume_slug) {
        $season_slug = !empty($settings['season_slug']) ? $settings['season_slug'] : 'season';
        
        $season_labels = array(
            'name' => __('–°–µ–∑–æ–Ω–∏', 'parfume-reviews'),
            'singular_name' => __('–°–µ–∑–æ–Ω', 'parfume-reviews'),
            'menu_name' => __('–°–µ–∑–æ–Ω–∏', 'parfume-reviews'),
        );
        
        register_taxonomy('season', 'parfume', array(
            'labels' => $season_labels,
            'hierarchical' => true,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $season_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_categories_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_season_terms();
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Intensity taxonomy
     */
    private function register_intensity_taxonomy($settings, $parfume_slug) {
        $intensity_slug = !empty($settings['intensity_slug']) ? $settings['intensity_slug'] : 'intensity';
        
        $intensity_labels = array(
            'name' => __('–ò–Ω—Ç–µ–Ω–∑–∏–≤–Ω–æ—Å—Ç', 'parfume-reviews'),
            'singular_name' => __('–ò–Ω—Ç–µ–Ω–∑–∏–≤–Ω–æ—Å—Ç', 'parfume-reviews'),
            'menu_name' => __('–ò–Ω—Ç–µ–Ω–∑–∏–≤–Ω–æ—Å—Ç', 'parfume-reviews'),
        );
        
        register_taxonomy('intensity', 'parfume', array(
            'labels' => $intensity_labels,
            'hierarchical' => true,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $intensity_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_categories_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_intensity_terms();
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Notes taxonomy
     */
    private function register_notes_taxonomy($settings, $parfume_slug) {
        $notes_slug = !empty($settings['notes_slug']) ? $settings['notes_slug'] : 'notes';
        
        $notes_labels = array(
            'name' => __('–ê—Ä–æ–º–∞—Ç–Ω–∏ –Ω–æ—Ç–∫–∏', 'parfume-reviews'),
            'singular_name' => __('–ê—Ä–æ–º–∞—Ç–Ω–∞ –Ω–æ—Ç–∫–∞', 'parfume-reviews'),
            'menu_name' => __('–ê—Ä–æ–º–∞—Ç–Ω–∏ –Ω–æ—Ç–∫–∏', 'parfume-reviews'),
        );
        
        register_taxonomy('notes', 'parfume', array(
            'labels' => $notes_labels,
            'hierarchical' => true,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $notes_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_categories_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_notes_terms();
    }
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ Perfumer taxonomy
     */
    private function register_perfumer_taxonomy($settings, $parfume_slug) {
        $perfumers_slug = !empty($settings['perfumers_slug']) ? $settings['perfumers_slug'] : 'parfumers';
        
        $perfumer_labels = array(
            'name' => __('–ü–∞—Ä—Ñ—é–º–µ—Ä–∏', 'parfume-reviews'),
            'singular_name' => __('–ü–∞—Ä—Ñ—é–º–µ—Ä', 'parfume-reviews'),
            'menu_name' => __('–ü–∞—Ä—Ñ—é–º–µ—Ä–∏', 'parfume-reviews'),
        );
        
        register_taxonomy('perfumer', 'parfume', array(
            'labels' => $perfumer_labels,
            'hierarchical' => false,
            'show_ui' => true,
            'show_admin_column' => true,
            'query_var' => true,
            'rewrite' => array(
                'slug' => $parfume_slug . '/' . $perfumers_slug,
                'with_front' => false,
                'hierarchical' => false
            ),
            'show_in_rest' => true,
            'public' => true,
            'publicly_queryable' => true,
            'meta_box_cb' => 'post_tags_meta_box',
            'show_in_nav_menus' => true,
            'show_tagcloud' => true,
        ));
        
        $this->add_default_perfumer_terms();
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Gender
     */
    private function add_default_gender_terms() {
        $default_genders = array(
            'unisex' => __('–£–Ω–∏—Å–µ–∫—Å', 'parfume-reviews'),
            'men' => __('–ú—ä–∂–∫–∏', 'parfume-reviews'),
            'women' => __('–î–∞–º—Å–∫–∏', 'parfume-reviews'),
        );
        
        foreach ($default_genders as $slug => $name) {
            if (!term_exists($slug, 'gender')) {
                wp_insert_term($name, 'gender', array('slug' => $slug));
            }
        }
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Aroma Type
     */
    private function add_default_aroma_type_terms() {
        $default_aroma_types = array(
            'floral' => __('–§–ª–æ—Ä–∞–ª–Ω–∏', 'parfume-reviews'),
            'oriental' => __('–û—Ä–∏–µ–Ω—Ç–∞–ª—Å–∫–∏', 'parfume-reviews'),
            'woody' => __('–î—ä—Ä–≤–µ—Å–Ω–∏', 'parfume-reviews'),
            'fresh' => __('–°–≤–µ–∂–∏', 'parfume-reviews'),
            'citrus' => __('–¶–∏—Ç—Ä—É—Å–æ–≤–∏', 'parfume-reviews'),
            'fruity' => __('–ü–ª–æ–¥–æ–≤–∏', 'parfume-reviews'),
            'spicy' => __('–ü–∏–∫–∞–Ω—Ç–Ω–∏', 'parfume-reviews'),
            'aquatic' => __('–í–æ–¥–Ω–∏', 'parfume-reviews'),
        );
        
        foreach ($default_aroma_types as $slug => $name) {
            if (!term_exists($slug, 'aroma_type')) {
                wp_insert_term($name, 'aroma_type', array('slug' => $slug));
            }
        }
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Brands
     */
    private function add_default_brand_terms() {
        $default_brands = array(
            'chanel' => 'Chanel',
            'dior' => 'Dior',
            'ysl' => 'Yves Saint Laurent',
            'versace' => 'Versace',
            'armani' => 'Giorgio Armani',
            'gucci' => 'Gucci',
            'prada' => 'Prada',
            'tom-ford' => 'Tom Ford',
        );
        
        foreach ($default_brands as $slug => $name) {
            if (!term_exists($slug, 'marki')) {
                wp_insert_term($name, 'marki', array('slug' => $slug));
            }
        }
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Season
     */
    private function add_default_season_terms() {
        $default_seasons = array(
            'spring' => __('–ü—Ä–æ–ª–µ—Ç', 'parfume-reviews'),
            'summer' => __('–õ—è—Ç–æ', 'parfume-reviews'),
            'autumn' => __('–ï—Å–µ–Ω', 'parfume-reviews'),
            'winter' => __('–ó–∏–º–∞', 'parfume-reviews'),
            'all-year' => __('–¶–µ–ª–æ–≥–æ–¥–∏—à–Ω–æ', 'parfume-reviews'),
        );
        
        foreach ($default_seasons as $slug => $name) {
            if (!term_exists($slug, 'season')) {
                wp_insert_term($name, 'season', array('slug' => $slug));
            }
        }
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Intensity
     */
    private function add_default_intensity_terms() {
        $default_intensities = array(
            'light' => __('–õ–µ–∫–∞', 'parfume-reviews'),
            'moderate' => __('–£–º–µ—Ä–µ–Ω–∞', 'parfume-reviews'),
            'strong' => __('–°–∏–ª–Ω–∞', 'parfume-reviews'),
            'very-strong' => __('–ú–Ω–æ–≥–æ —Å–∏–ª–Ω–∞', 'parfume-reviews'),
        );
        
        foreach ($default_intensities as $slug => $name) {
            if (!term_exists($slug, 'intensity')) {
                wp_insert_term($name, 'intensity', array('slug' => $slug));
            }
        }
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Notes
     */
    private function add_default_notes_terms() {
        $default_notes = array(
            'rose' => __('–†–æ–∑–∞', 'parfume-reviews'),
            'jasmine' => __('–ñ–∞—Å–º–∏–Ω', 'parfume-reviews'),
            'vanilla' => __('–í–∞–Ω–∏–ª–∏—è', 'parfume-reviews'),
            'sandalwood' => __('–°–∞–Ω–¥–∞–ª–æ–≤–æ –¥—ä—Ä–≤–æ', 'parfume-reviews'),
            'bergamot' => __('–ë–µ—Ä–≥–∞–º–æ—Ç', 'parfume-reviews'),
            'lavender' => __('–õ–∞–≤–∞–Ω–¥—É–ª–∞', 'parfume-reviews'),
            'musk' => __('–ú—É—Å–∫—É—Å', 'parfume-reviews'),
            'amber' => __('–ê–º–±—Ä–∞', 'parfume-reviews'),
        );
        
        foreach ($default_notes as $slug => $name) {
            if (!term_exists($slug, 'notes')) {
                wp_insert_term($name, 'notes', array('slug' => $slug));
            }
        }
    }
    
    /**
     * –î–æ–±–∞–≤—è default terms –∑–∞ Perfumer
     */
    private function add_default_perfumer_terms() {
        $default_perfumers = array(
            'jacques-polge' => 'Jacques Polge',
            'olivier-polge' => 'Olivier Polge',
            'alberto-morillas' => 'Alberto Morillas',
            'francois-demachy' => 'Fran√ßois Demachy',
            'jean-claude-ellena' => 'Jean-Claude Ellena',
            'thierry-wasser' => 'Thierry Wasser',
        );
        
        foreach ($default_perfumers as $slug => $name) {
            if (!term_exists($slug, 'perfumer')) {
                wp_insert_term($name, 'perfumer', array('slug' => $slug));
            }
        }
    }
}